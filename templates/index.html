<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Built-Theory | Advanced Engineering PDF Suite</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div id="processingOverlay" class="processingOverlay" style="display:none;">
        <div class="spinner-container"><div class="spinner-main"></div></div>
        <div class="processing-text">Built-Theory is working...</div>
        <div class="processing-subtext">Processing large engineering files (up to 10GB) may take a moment.</div>
    </div>

    <nav>
        <a href="/" class="logo">Built-Theory<span>PRO</span></a>
        <div class="nav-links">
            <span onclick="document.getElementById('tools').scrollIntoView()">All Tools</span>
            <span id="navJoinPro" onclick="showPremiumModal()" style="color:var(--primary); font-weight:700; cursor:pointer;">JOIN PRO</span>
        </div>
        
        <div id="authSection">
            <button class="btn-login" onclick="loginWithGoogle()">Login</button>
        </div>
        
        <div class="user-profile" id="userProfile" style="display:none;">
            <div class="premium-badge" id="premiumBadge" style="display:none;">PRO Member</div>
            <img id="userAvatar" class="user-avatar" src="" style="width:35px; border-radius:50%;">
            <button class="btn-login" onclick="logout()" style="background:#f0f0f0; color:#333; margin-left:10px;">Logout</button>
            <button class="btn-login" id="upgradeBtn" onclick="showPremiumModal()" style="background:#FFD700; color:#000; margin-left:10px;">Go Pro</button>
        </div>
    </nav>

    <div class="hero">
        <h1>Engineering & PDF Intelligence</h1>
        <p>10GB file limits and professional AI academic tools for engineering students.</p>
        <div style="margin-top:25px; display:flex; gap:15px; justify-content:center;">
            <button class="primary-btn" onclick="document.getElementById('tools').scrollIntoView()">Get Started</button>
            <button class="primary-btn" id="heroJoinPro" style="background:var(--dark);" onclick="showPremiumModal()">Explore Pro Plans</button>
        </div>
    </div>

    <div class="container" id="tools">
        
        <div class="category-section">
            <div class="category-title"><i class="fas fa-graduation-cap"></i> Academic AI Tools</div>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('ppt_gen')">
                    <div class="tool-icon"><i class="fas fa-file-powerpoint"></i></div>
                    <h3>Topic to PPT</h3>
                    <p>Free: 5/mo | Pro: Unlimited</p>
                </div>
            </div>
        </div>

        <div class="category-section">
            <div class="category-title"><i class="fas fa-layer-group"></i> Organize & Optimize</div>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('merge')"><div class="tool-icon"><i class="fas fa-object-group"></i></div><h3>Merge PDF</h3><p>Combine multiple reports.</p></div>
                <div class="tool-card" onclick="openTool('split')"><div class="tool-icon"><i class="fas fa-cut"></i></div><h3>Split PDF</h3><p>Extract specific pages.</p></div>
                <div class="tool-card" onclick="openTool('compress')"><div class="tool-icon"><i class="fas fa-compress-arrows-alt"></i></div><h3>Compress PDF</h3><p>Reduce size for submission.</p></div>
                <div class="tool-card" onclick="openTool('repair')"><div class="tool-icon"><i class="fas fa-tools"></i></div><h3>Repair PDF</h3><p>Fix corrupted drawings.</p></div>
                <div class="tool-card" onclick="openTool('ocr')"><div class="tool-icon"><i class="fas fa-eye"></i></div><h3>OCR PDF</h3><p>Make scans searchable.</p></div>
                <div class="tool-card" onclick="openTool('rotate')"><div class="tool-icon"><i class="fas fa-sync-alt"></i></div><h3>Rotate PDF</h3><p>Fix page orientation.</p></div>
            </div>
        </div>

        <div class="category-section">
            <div class="category-title"><i class="fas fa-exchange-alt"></i> Engineering Converters</div>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('img2pdf')"><div class="tool-icon"><i class="fas fa-image"></i></div><h3>JPG to PDF</h3><p>Photos to Document.</p></div>
                <div class="tool-card" onclick="openTool('word2pdf')"><div class="tool-icon"><i class="fas fa-file-word"></i></div><h3>Word to PDF</h3><p>Reports to Submission.</p></div>
                <div class="tool-card" onclick="openTool('ppt2pdf')"><div class="tool-icon"><i class="fas fa-file-powerpoint"></i></div><h3>PPT to PDF</h3><p>Slides to Handouts.</p></div>
                <div class="tool-card" onclick="openTool('excel2pdf')"><div class="tool-icon"><i class="fas fa-file-excel"></i></div><h3>Excel to PDF</h3><p>Sheets to Documents.</p></div>
                <div class="tool-card" onclick="openTool('pdf2jpg')"><div class="tool-icon"><i class="fas fa-file-image"></i></div><h3>PDF to JPG</h3><p>Extract Images.</p></div>
                <div class="tool-card" onclick="openTool('pdf2word')"><div class="tool-icon"><i class="fas fa-file-word"></i></div><h3>PDF to Word</h3><p>Make PDF editable.</p></div>
                <div class="tool-card" onclick="openTool('pdf2ppt')"><div class="tool-icon"><i class="fas fa-file-powerpoint"></i></div><h3>PDF to PPT</h3><p>Extract to Slides.</p></div>
                <div class="tool-card" onclick="openTool('pdf2excel')"><div class="tool-icon"><i class="fas fa-file-excel"></i></div><h3>PDF to Excel</h3><p>Table Extraction.</p></div>
                <div class="tool-card" onclick="openTool('pdf2pdfa')"><div class="tool-icon"><i class="fas fa-archive"></i></div><h3>PDF to PDF/A</h3><p>Long-term storage.</p></div>
                <div class="tool-card" onclick="openTool('html2pdf')"><div class="tool-icon"><i class="fas fa-code"></i></div><h3>HTML to PDF</h3><p>Webpage Capture.</p></div>
            </div>
        </div>

        <div class="category-section">
            <div class="category-title"><i class="fas fa-shield-alt"></i> Security & Pro Features</div>
            <div class="tools-grid">
                <div class="tool-card pro-card" onclick="openTool('unlock')"><div class="tool-icon"><i class="fas fa-unlock"></i></div><h3>Unlock PDF</h3><p>PRO Only Tool</p></div>
                <div class="tool-card pro-card" onclick="openTool('protect')"><div class="tool-icon"><i class="fas fa-user-lock"></i></div><h3>Protect PDF</h3><p>PRO Only Tool</p></div>
                <div class="tool-card pro-card" onclick="openTool('watermark')"><div class="tool-icon"><i class="fas fa-stamp"></i></div><h3>Watermark</h3><p>PRO Only Tool</p></div>
                <div class="tool-card pro-card" onclick="openTool('pagenum')"><div class="tool-icon"><i class="fas fa-list-ol"></i></div><h3>Page Numbers</h3><p>PRO Only Tool</p></div>
                <div class="tool-card pro-card" onclick="openTool('edit')"><div class="tool-icon"><i class="fas fa-pen"></i></div><h3>Edit PDF</h3><p>PRO Only Tool</p></div>
                <div class="tool-card pro-card" onclick="openTool('sign')"><div class="tool-icon"><i class="fas fa-signature"></i></div><h3>Sign PDF</h3><p>PRO Only Tool</p></div>
            </div>
        </div>
    </div>

    <div id="workspace" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:500; flex-direction:column; align-items:center; justify-content:center;">
        <div class="workspace-header" style="padding:20px; width:100%; display:flex; justify-content:space-between; border-bottom:1px solid #eee;">
            <div class="logo">Built-Theory Workspace</div>
            <i class="fas fa-times" onclick="closeWorkspace()" style="cursor:pointer; font-size:1.5rem; color:#888;"></i>
        </div>
        <div class="upload-box" id="dropArea" onclick="document.getElementById('fileInput').click()">
            <input type="file" id="fileInput" multiple style="display:none;">
            <i class="fas fa-cloud-upload-alt" style="font-size:3.5rem; color:var(--primary); margin-bottom:15px;"></i>
            <h3>Drop your files here</h3>
            <p id="limitInfo">Limit: 50MB</p>
        </div>
        
        <div id="pptForm" style="display:none; width:90%; max-width:500px; margin-top:20px;">
            <input type="text" id="pptTopic" placeholder="Topic Name (e.g. Civil Engineering Foundation)" style="width:100%; padding:15px; margin-bottom:10px; border-radius:12px; border:1px solid #ddd;">
            <textarea id="pptDetails" placeholder="Add specific details or keywords..." style="width:100%; padding:15px; height:120px; border-radius:12px; border:1px solid #ddd;"></textarea>
        </div>
        
        <button class="primary-btn" id="processBtn" style="display:none; margin-top:20px; padding:15px 50px;" onclick="processFiles()">Process Files</button>
    </div>

    <div id="premiumModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; justify-content:center; align-items:center;">
        <div class="modal-content" style="background:white; padding:40px; border-radius:25px; text-align:center; width:95%; max-width:450px; box-shadow:0 15px 50px rgba(0,0,0,0.3);">
            <h2 style="color:var(--primary); font-size:1.8rem;">Join Built-Theory PRO</h2>
            <p style="margin-bottom:25px; color:#555;">Unlock 10GB limits and all 27+ academic tools.</p>
            <div style="display:grid; gap:15px;">
                <button class="primary-btn" onclick="payPro(59)" style="padding:15px;">Weekly Student Pass - ₹59</button>
                <button class="primary-btn" onclick="payPro(199)" style="padding:15px;">Monthly Full Access - ₹199</button>
                <button class="primary-btn" onclick="payPro(1999)" style="background:linear-gradient(45deg, #FFD700, #FFA500); color:black; padding:18px; font-weight:800;">Lifetime Elite - ₹1999</button>
            </div>
            <p onclick="document.getElementById('premiumModal').style.display='none'" style="cursor:pointer; color:#888; margin-top:20px; font-size:0.9rem;">No thanks, I'll stay Free</p>
        </div>
    </div>

    <script>
        // --- CONFIG & INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAZvTrFE81bYQ2R7JxQZnV3x6tmh_j6yL0",
            authDomain: "built-theory-auth-439a4.firebaseapp.com",
            projectId: "built-theory-auth-439a4",
            storageBucket: "built-theory-auth-439a4.firebasestorage.app",
            messagingSenderId: "621216043890",
            appId: "1:621216043890:web:8446c3344595abc38e43eb"
        };
        const RAZORPAY_KEY = "rzp_live_SDvXBbpBeVUe5U";
        const API_BASE = "https://built-theory-frontend.onrender.com/api";

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let isPremium = false;
        let currentTool = '';
        
        // --- 27+ TOOLS REGISTRY ---
        const PRO_ONLY = ['unlock', 'protect', 'watermark', 'pagenum', 'edit', 'sign', 'repair', 'ocr', 'pdf2word', 'pdf2excel', 'pdf2ppt', 'pdf2pdfa'];

        // --- AUTH LOGIC ---
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('userProfile').style.display = 'flex';
                document.getElementById('userAvatar').src = user.photoURL;
                
                const doc = await db.collection('users').doc(user.uid).get();
                if (doc.exists && doc.data().isPremium) {
                    isPremium = true;
                    document.getElementById('premiumBadge').style.display = 'block';
                    document.getElementById('upgradeBtn').style.display = 'none';
                    document.getElementById('navJoinPro').style.display = 'none';
                }
            }
        });

        // --- TOOL WORKFLOW ---
        function openTool(tool) {
            if (PRO_ONLY.includes(tool) && !isPremium) {
                showPremiumModal();
                return;
            }
            currentTool = tool;
            document.getElementById('workspace').style.display = 'flex';
            document.getElementById('limitInfo').innerText = isPremium ? "Limit: 10GB (PRO)" : "Limit: 50MB (Free)";
            document.getElementById('pptForm').style.display = (tool === 'ppt_gen') ? 'block' : 'none';
            document.getElementById('dropArea').style.display = (tool === 'ppt_gen') ? 'none' : 'flex';
            
            // Logic for Tools that don't need files
            if(tool === 'ppt_gen') document.getElementById('processBtn').style.display = 'block';
        }

        function closeWorkspace() { document.getElementById('workspace').style.display = 'none'; }
        function showPremiumModal() { document.getElementById('premiumModal').style.display = 'flex'; }

        // --- PAYMENT LOGIC ---
        function payPro(amount) {
            if (!currentUser) { alert("Login required to unlock PRO!"); loginWithGoogle(); return; }

            const options = {
                "key": RAZORPAY_KEY,
                "amount": amount * 100,
                "currency": "INR",
                "name": "Built-Theory PRO",
                "handler": async function(response) {
                    await db.collection('users').doc(currentUser.uid).set({
                        isPremium: true,
                        plan: amount,
                        payId: response.razorpay_payment_id,
                        email: currentUser.email
                    }, { merge: true });
                    
                    // Send Automated Receipt via Backend
                    fetch(`${API_BASE}/payment-success`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: currentUser.email, amount: amount })
                    });

                    alert("Welcome to PRO! 10GB Limits Unlocked.");
                    location.reload();
                },
                "prefill": { "email": currentUser.email },
                "theme": { "color": "#ff4747" }
            };
            new Razorpay(options).open();
        }

        // --- CORE ENGINE ---
        async function processFiles() {
            const files = document.getElementById('fileInput').files;
            const overlay = document.getElementById('processingOverlay');
            
            // Limit Checking
            if (currentTool !== 'ppt_gen') {
                const totalSize = Array.from(files).reduce((acc, f) => acc + f.size, 0);
                const limit = isPremium ? 10 * 1024 * 1024 * 1024 : 50 * 1024 * 1024;
                
                if (totalSize > limit) {
                    alert(`Submission too large! Your current limit: ${isPremium ? '10GB' : '50MB'}`);
                    return;
                }
            }

            overlay.style.display = 'flex';
            const formData = new FormData();
            
            // Dynamic Form Population for all 27+ tools
            if (currentTool === 'merge' || currentTool === 'img2pdf') {
                Array.from(files).forEach(f => formData.append('files', f));
            } else if (currentTool === 'ppt_gen') {
                formData.append('topic', document.getElementById('pptTopic').value);
                formData.append('details', document.getElementById('pptDetails').value);
            } else {
                formData.append('file', files[0]);
            }

            try {
                const res = await fetch(`${API_BASE}/${currentTool}`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!res.ok) throw new Error("Backend processing error.");
                
                const blob = await res.blob();
                const ext = (currentTool === 'ppt_gen') ? 'pptx' : (currentTool === 'pdf2jpg' ? 'zip' : 'pdf');
                download(blob, `BuiltTheory_${currentTool}_Done.${ext}`);
                
            } catch (e) { 
                alert("Server issue detected. Ensure Render backend is LIVE."); 
            } finally { 
                overlay.style.display = 'none'; 
            }
        }

        function loginWithGoogle() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function logout() { auth.signOut().then(() => location.reload()); }

        document.getElementById('fileInput').addEventListener('change', () => {
            if(document.getElementById('fileInput').files.length > 0) 
                document.getElementById('processBtn').style.display = 'block';
        });
    </script>
</body>
</html>
